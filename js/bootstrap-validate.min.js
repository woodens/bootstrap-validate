(function($,window,document,undefined){$.fn.SimValidate=function(options){var simVali=new SimValidate(this,options);simObject=simVali;return simVali};var SimValidate=function(eles,options){if(eles==null||eles==undefined){alert("没有设定校验元素!");return}this.$eles=eles;this.eles_path=this.getPath(eles);this.defaults={shortTest:true,autoTest:true};this.settings=$.extend({},this.defaults,options);eles.find("[message-for]").addClass("sr-only");eles.find("[message-for]").closest(".form-group").removeClass("has-error");if(this.settings["autoTest"]){this.autoValidate()}this.delDepend()};SimValidate.prototype={autoValidate:function(){var validators=this.validators;var $eles=this.$eles;var eles_path=this.eles_path;var settings=this.settings;var simValidate=this;$eles.find("[test-id]").each(function(index){var test_id=$(this).attr("test-id");var $element=$(this);if($element.find("[test-point]").size()==0){$(eles_path).on("focus","[test-id='"+test_id+"']",function(){$eles.find("[message-for='"+test_id+"']").addClass("sr-only");$eles.find("[message-for='"+test_id+"']").closest(".form-group").removeClass("has-error")});$(eles_path).on("keyup","[test-id='"+test_id+"']",function(){simValidate.testElement($element,test_id)});$(eles_path).on("blur","[test-id='"+test_id+"']",function(){simValidate.testElement($element,test_id)});$(eles_path).on("change","[test-id='"+test_id+"']",function(){simValidate.testElement($element,test_id)})}else{$(eles_path).on("focus","[test-id='"+test_id+"'] [test-point]",function(){$eles.find("[message-for='"+test_id+"']").addClass("sr-only");$eles.find("[message-for='"+test_id+"']").closest(".form-group").removeClass("has-error")});$(eles_path).on("keyup","[test-id='"+test_id+"'] [test-point]",function(){$eles.find("[message-for='"+test_id+"']").addClass("sr-only");$eles.find("[message-for='"+test_id+"']").closest(".form-group").removeClass("has-error");simValidate.testElement($element)});$(eles_path).on("blur","[test-id='"+test_id+"'] [test-point]",function(){$eles.find("[message-for='"+test_id+"']").addClass("sr-only");$eles.find("[message-for='"+test_id+"']").closest(".form-group").removeClass("has-error");simValidate.testElement($element)});$(eles_path).on("change","[test-id='"+test_id+"'] [test-point]",function(){$eles.find("[message-for='"+test_id+"']").addClass("sr-only");$eles.find("[message-for='"+test_id+"']").closest(".form-group").removeClass("has-error");simValidate.testElement($element)});$(eles_path).on("click","[test-id='"+test_id+"'] [test-point]",function(){$eles.find("[message-for='"+test_id+"']").addClass("sr-only");$eles.find("[message-for='"+test_id+"']").closest(".form-group").removeClass("has-error");simValidate.testElement($element,test_id)})}})},validate:function(){this.$eles.find("[message-for]").addClass("sr-only");this.$eles.find("[message-for]").closest(".form-group").removeClass("has-error");var total_valid=true;var simValidate=this;this.$eles.find("[test-id]").each(function(index){total_valid&=simValidate.testElement($(this))});return total_valid},testElement:function($point){var validators=this.validators;var $eles=this.$eles;var settings=this.settings;var single_valid=true;for(var key in validators){if(settings["shortTest"]&&!single_valid)break;var param=$point.attr(key);if(param==null)continue;var validator=validators[key];var value=$point.val();var test_id=$point.attr("test-id");if($point.data("depend")&&!$eles.find('[test-depend="'+$point.data("depend")+'"]').is(":checked")){continue}if(!validator(value,param,$point,this)){if($eles.find("[message-for='"+test_id+"']").size()>1){$eles.find("[message-for='"+test_id+"'][test-type='"+key+"']").siblings().addClass("sr-only");$eles.find("[message-for='"+test_id+"'][test-type='"+key+"']").removeClass("sr-only");$eles.find("[message-for='"+test_id+"'][test-type='"+key+"']").closest(".form-group").addClass("has-error")}else{$eles.find("[message-for='"+test_id+"']").siblings().addClass("sr-only");$eles.find("[message-for='"+test_id+"']").removeClass("sr-only");$eles.find("[message-for='"+test_id+"']").closest(".form-group").addClass("has-error")}single_valid=false}else{if($eles.find("[message-for='"+test_id+"']").size()>1){$eles.find("[message-for='"+test_id+"'][test-type='"+key+"']").addClass("sr-only");$eles.find("[message-for='"+test_id+"'][test-type='"+key+"']").closest(".form-group").removeClass("has-error")}else{$eles.find("[message-for='"+test_id+"']").addClass("sr-only");$eles.find("[message-for='"+test_id+"']").closest(".form-group").removeClass("has-error")}}}return single_valid},delDepend:function(){var eles_path=this.eles_path;var $eles=this.$eles;$(eles_path).on("change","[test-depend]",function(){var $element=$(this);if(!$element.is(":checked")){$eles.find("[data-depend]").each(function(){var $element2=$(this);var test_id=$element2.attr("test-id");if($element2.data("depend")==$element.attr("test-depend")){$eles.find("[message-for='"+test_id+"']").addClass("sr-only");$eles.find("[message-for='"+test_id+"']").closest(".form-group").removeClass("has-error")}})}})},extend:function(validators){$.extend(this.validators,validators)},getPath:function($element){if($element.length!=1)throw"Requires one element.";var path,node=$element;while(node.length){var realNode=node[0],name=realNode.localName;if(!name)break;name=name.toLowerCase();var parent=node.parent();var siblings=parent.children(name);if(siblings.length>1){name+=":eq("+siblings.index(realNode)+")"}path=name+(path?">"+path:"");node=parent}return path}};SimValidate.prototype.validators={distinct:function(value,param,point,obj){if(value==null||value.length==0)return true;var self_test_id=point.attr("test-id");var diff=false;$("[distinct='"+param+"']").each(function(){if(self_test_id!=$(this).attr("test-id")&&value==$(this).val())diff=true});return!diff},equalTo:function(value,param,point,obj){if(value==null||value.length==0)return true;if(obj.settings["autoTest"]){var test_id=point.attr("test-id");$(obj.eles_path).on("blur","[test-id='"+param+"']",function(){obj.$eles.find("[message-for='"+test_id+"']").addClass("sr-only");obj.$eles.find("[message-for='"+test_id+"']").closest(".form-group").removeClass("has-error");obj.testElement(point)})}if(obj.$eles.find("[test-id='"+param+"']").val()==value)return true;else return false},required:function(value){if(value==null||value.length==0)return false;else return true},number:function(value){if(value==null||value.length==0)return true;if(value.length>0&&$.trim(value).length==0)return false;return!isNaN(value)},groupRequired:function(value,param,group){var valid=false;group.find("[test-point]").each(function(){if($(this).is(":checked"))valid=true});return valid},max:function(value,num){if(value==null||value.length==0)return true;if(parseFloat(value)>parseFloat(num))return false;else return true},min:function(value,num){if(value==null||value.length==0)return true;if(parseFloat(value)<parseFloat(num))return false;else return true},minlength:function(value,num){if(value==null||value.length==0)return true;if(value.length<parseFloat(num))return false;else return true},email:function(value){if(value==null||value.length==0)return true;var reg=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(reg.test(value)){return true}else{return false}},mobile:function(value){if(value==null||value.length==0)return true;var isMob=/^((\+?86)|(\(\+86\)))?(13[012356789][0-9]{8}|15[012356789][0-9]{8}|17[012356789][0-9]{8}|18[02356789][0-9]{8}|147[0-9]{8}|1349[0-9]{7})$/;if(isMob.test(value)){return true}else{return false}},idcard:function(idCard){if(idCard==null||idCard.length==0)return true;var regIdCard=/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/;if(regIdCard.test(idCard)){if(idCard.length==18){var idCardWi=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var idCardY=new Array(1,0,10,9,8,7,6,5,4,3,2);var idCardWiSum=0;for(var i=0;i<17;i++){idCardWiSum+=idCard.substring(i,i+1)*idCardWi[i]}var idCardMod=idCardWiSum%11;var idCardLast=idCard.substring(17);if(idCardMod==2){if(idCardLast=="X"||idCardLast=="x"){return true}else{return false}}else{if(idCardLast==idCardY[idCardMod]){return true}else{return false}}}}else{return false}}}})(jQuery,window,document);